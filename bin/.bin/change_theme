#!/bin/bash
# Change theme colors

# Create needed directories
ROOT_DIR=~/.local/state/waybar/modules/themetoggler
mkdir -p $ROOT_DIR
touch $ROOT_DIR/theme-color
touch $ROOT_DIR/toggler-state

color=${1:-$(cat $ROOT_DIR/theme-color)}
if [ -z "$color" ]; then
  echo "Usage: $0 <light|dark>"
  exit 1
fi

if [ -z "$1" ]; then
  if [ "$color" == "light" ]; then
    color="dark"
  else
    color="light"
  fi
fi

LIGHT_THEME=Breeze
LIGHT_ICON_THEME=breeze
LIGHT_COLOR_SCHEME=prefer-light

DARK_THEME=Breeze-Dark
DARK_ICON_THEME=breeze-dark
DARK_COLOR_SCHEME=prefer-dark

if [ "$color" == "light" ]; then
  sed -i "s/^gtk-theme=.*/gtk-theme=$LIGHT_THEME/" ~/.local/share/nwg-look/gsettings
  sed -i "s/^icon-theme=.*/icon-theme=$LIGHT_ICON_THEME/" ~/.local/share/nwg-look/gsettings
  sed -i "s/^color-scheme=.*/color-scheme=$LIGHT_COLOR_SCHEME/" ~/.local/share/nwg-look/gsettings
  sed -i "s/^gtk-theme-name=.*/gtk-theme-name=$LIGHT_THEME/" ~/.gtkrc-2.0
  sed -i "s/^gtk-icon-theme-name=.*/gtk-icon-theme-name=$LIGHT_ICON_THEME/" ~/.gtkrc-2.0
  sed -i "s/^gtk-theme-name=.*/gtk-theme-name=$LIGHT_THEME/" ~/.config/gtk-3.0/settings.ini
  sed -i "s/^gtk-icon-theme-name=.*/gtk-icon-theme-name=$LIGHT_ICON_THEME/" ~/.config/gtk-3.0/settings.ini
  sed -i "s/^gtk-application-prefer-dark-theme=.*/gtk-application-prefer-dark-theme=0/" ~/.config/gtk-3.0/settings.ini
  sed -i "s/^gtk-application-prefer-dark-theme=.*/gtk-application-prefer-dark-theme=false/" ~/.config/gtk-4.0/settings.ini
fi

if [ "$color" == "dark" ]; then
  sed -i "s/^gtk-theme=.*/gtk-theme=$DARK_THEME/" ~/.local/share/nwg-look/gsettings
  sed -i "s/^icon-theme=.*/icon-theme=$DARK_ICON_THEME/" ~/.local/share/nwg-look/gsettings
  sed -i "s/^color-scheme=.*/color-scheme=$DARK_COLOR_SCHEME/" ~/.local/share/nwg-look/gsettings
  sed -i "s/^gtk-theme-name=.*/gtk-theme-name=$DARK_THEME/" ~/.gtkrc-2.0
  sed -i "s/^gtk-icon-theme-name=.*/gtk-icon-theme-name=$DARK_ICON_THEME/" ~/.gtkrc-2.0
  sed -i "s/^gtk-theme-name=.*/gtk-theme-name=$DARK_THEME/" ~/.config/gtk-3.0/settings.ini
  sed -i "s/^gtk-icon-theme-name=.*/gtk-icon-theme-name=$DARK_ICON_THEME/" ~/.config/gtk-3.0/settings.ini
  sed -i "s/^gtk-application-prefer-dark-theme=.*/gtk-application-prefer-dark-theme=1/" ~/.config/gtk-3.0/settings.ini
  sed -i "s/^gtk-application-prefer-dark-theme=.*/gtk-application-prefer-dark-theme=true/" ~/.config/gtk-4.0/settings.ini
fi

nwg-look -a 2>/dev/null

echo "$color" >$ROOT_DIR/theme-color

### Setup for Waybar custom themetoggler module
## Material Design Icons
if [ "$color" == "light" ]; then
  # moon-waning-crescent icon
  echo '{"text": "󰽥", "tooltip": "Switch to dark theme"}' >$ROOT_DIR/toggler-state
else
  # white-balance-sunny icon
  echo '{"text": "󰖨", "tooltip": "Switch to light theme"}' >$ROOT_DIR/toggler-state
fi
